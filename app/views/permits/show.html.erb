<!-- Left side of the show, with the Clickable Sections -->

<div class="container" style="border: 2px solid $grey-lighter; padding: 0px; display: flex; min-height: 100vh;">
  <div class="section-container">
    <div class="section-item" data-id="1">Section 1 - Permit Details</div>
    <div class="section-item" data-id="2">Section 2 - Excavation dimensions</div>
    <div class="section-item" data-id="3">Section 3 - Services located within the area</div>
    <div class="section-item" data-id="4">Section 4 - Confirmation</div>
    <div class="section-item" data-id="5">Section 5 - Mechanical Dig</div>
  </div>

  <!-- Middle section with the permit info -->

  <div class="selected-container">
    <div class="selected-section show-section" data-id="1">
      <div class="container-permit-details">
        <p>Project <%= @permit.project_id %></p>
        <p>number: <%= @permit.permit_number %></p>
        <p>Start date: <%= @permit.start_date.strftime("%d-%m-%Y") %> at <%= @permit.start_date.strftime("%I:%M%p") %></p>
        <p>Expiry date: <%= @permit.end_date.strftime("%d-%m-%Y") %> at <%= @permit.end_date.strftime("%I:%M%p") %></p>
        <% if @permit.status == "draft" %>
          <p><i><strong>DRAFT</strong></i></p>
        <% elsif @permit.status == "pending approval" %>
          <p>Awaiting approval from <strong><%= @approver %></strong></p>
        <% elsif @permit.status == "approved" %>
          <p>Approved by: <%= @approver %></p>
        <% elsif @permit.status == "rejected" %>
          <p>Permit rejected by: <%= @approver %></p>
        <% elsif @permit.status == "expired" %>
          <p><strong>Permit expired</strong></p>
        <% end %>
        <p>Permit title: <%= @permit.title %></p>
        <p>Level : <%= @permit.level %></p>
        <p>Location : <%= @permit.location %> </p>
        <p>Method Statement: <%= @permit.method_statement %></p>
        <p>Permit Type: <%= @permit.permit_type %></p>
      </div>
    </div>


    <div class="selected-section" data-id="2">
      <div class="container">
        <div class="excavation">
          <p>xwidth: <%= @permit.xwidth %>mm</p>
          <p>xdepth: <%= @permit.xdepth %>mm</p>
          <p>xlength: <%= @permit.xlength %>m</p>
        </div>
      </div>
    </div>


    <div class="selected-section" data-id="3">
      <div class="container">
        <div class="excavation">
          <% @permit.attributes.to_a[(13..24)].each do |ele| %>
            <% if ele[1] == true %>
              <p><%= ele[0].gsub(/_/, " ").capitalize %></p>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>


    <div class="selected-section" data-id="4">
      <div class="container">
        <div class="excavation">
          <p>Cat Scanner model: <%= @permit.cat_scan_model %></p>
          <p> Serial number: <%= @permit.cat_scanner_serial %></p>
          <p>Genny model: <%= @permit.genny_model %></p>
          <p> Serial number: <%= @permit.genny_serial %></p>
          <p>Operator: <%= @permit.cat_genny_operator %></p>
          <p>Calibration expires: <%= @permit.calibration_expires.strftime("%d-%m-%Y") %></p>
          <p>Modes used:</p>
          <ul>
            <% if @permit.cat_mode_power == true %>
              <li>Power <i class="far fa-check-circle"></i></li>
            <% else %>
              <li>Power <i class="far fa-times-circle"></i></li>
            <% end %>
            <% if @permit.cat_mode_radio == true %>
              <li>Radio <i class="far fa-check-circle"></i></li>
            <% else %>
              <li>Radio <i class="far fa-times-circle"></i></li>
            <% end %>
            <% if @permit.cat_mode_transmitter == true %>
              <li>Transmitter <i class="far fa-check-circle"></i></li>
            <% else %>
              <li>Transmitter <i class="far fa-times-circle"></i></li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>


    <div class="selected-section" data-id="5">
      <div class="container">
        <div class="mechanical-dig">
          <% @permit.attributes.to_a[(25..33)].each do |ele| %>
            <% if ele[1] == true %>
              <p class="tag"><%= ele[0].gsub(/_/, " ").capitalize %></p>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

<!-- Right side with button and user card -->

  <div class="action-btn-container">
    <% if (@permit.status == "pending approval" && @permit.approver == current_user) %>
      <div class="container-btn-approval">
        <%= link_to 'Approve permit', permit_approve_path(@permit), class: "approve-btn"%>
        <%= link_to 'Reject permit', permit_reject_path(@permit), class: "approve-btn reject-btn" %>
      </div>
    <% elsif (@permit.status == "rejected" || @permit.status == "draft") && (@permit.approver == current_user || @permit.author == current_user) %>
      <%= link_to 'Edit permit', edit_permit_path(@permit), class: "approve-btn edit-btn" %>
    <% end %>
    <% if @permit.status == "draft" || @permit.status == "rejected" && @permit.author == current_user %>
      <%= link_to 'Delete permit', permit_path(@permit), class: "approve-btn reject-btn", method: :delete, data: { confirm: "Deleting permit... Are you sure?" } %>
    <% end %>
    <div class="detail-card-permit">
      <div class="author-avatar">
        <img class="avatar" src= <%= @permit.author.avatar %> />
        <div class="author-name">
          <p>Author: <%= @permit.author.fullname %></p>
          <p>Role: <%= @permit.author.role %></p>
        </div>
      </div>
      <hr>
      <% if @permit.approver.present? %>
        <div class="approver-avatar">
          <img class="avatar" src= <%= @permit.approver.avatar %> />
          <div class="approver-name">
            <p>Approver: <%= @permit.approver.fullname %></p>
            <p>Role: <%= @permit.approver.role %></p>
          </div>
        </div>
      <% else %>
        <div class="approver-avatar">
          <p>Approver to be confirmed</p>
        </div>
      <% end %>
    </div>
  </div>
</div>






<script>
  var sectionItems = document.querySelectorAll(".section-item");
  sectionItems.forEach((sectionItem) => {
    sectionItem.addEventListener("click", (event) => {
      var sectionId = event.currentTarget.dataset.id
      var selectedSections = document.querySelectorAll(`div.selected-section`);
      var selectedSection;
      var deselectedSection;
      selectedSections.forEach((element) => {
        if(element.dataset.id == sectionId) {
          selectedSection = element;
        }
        if(element.className == "selected-section show-section") {
          deselectedSection = element;
        }
      });
      if (selectedSection != deselectedSection) {
        selectedSection.classList.add("show-section");
        deselectedSection.classList.remove("show-section");
      }
    });
  });
</script>



















